# RRNET - FreeRADIUS config (REST-only relay, NO password validation)
# FreeRADIUS = relay only, Backend = single source of truth
# User-Password sent as-is to backend (backend handles all validation)

server default {
	listen {
		type = auth
		ipaddr = *
		port = 0
	}

	listen {
		type = acct
		ipaddr = *
		port = 0
	}

	authorize {
		preprocess
		#
		# Set Auth-Type := REST directly (NO PAP)
		# FreeRADIUS does NOT decode/validate password
		# Backend handles all password validation
		#
		if (&User-Password) {
			update control {
				Auth-Type := REST
			}
		}
	}

	authenticate {
		Auth-Type REST {
			update control {
				# REST API secret (hardcoded for simplicity)
				# Default: dev-radius-rest-secret (change if needed)
				# For production, consider using env var: $ENV{RRNET_RADIUS_REST_SECRET}
				&REST-HTTP-Header += "X-RRNET-RADIUS-SECRET: dev-radius-rest-secret"
			}

			rest
			#
			# rlm_rest returns:
			# - ok      → HTTP 2xx with no reply attrs
			# - updated → reply attrs set
			#
			if (ok || updated) {
				ok
			}
		}
	}

	preacct {
		preprocess
	}

	accounting {
		update control {
			# REST API secret (hardcoded for simplicity)
			# Default: dev-radius-rest-secret (change if needed)
			# For production, consider using env var: $ENV{RRNET_RADIUS_REST_SECRET}
			&REST-HTTP-Header += "X-RRNET-RADIUS-SECRET: dev-radius-rest-secret"
		}

		rest
	}
}


